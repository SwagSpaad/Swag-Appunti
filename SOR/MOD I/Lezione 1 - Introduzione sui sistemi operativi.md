# Lezione 1
## Introduzione al corso. Introduzione sui sistemi operativi. Struttura della memoria. Struttura di I/O.
---
## I sistemi operativi
Un sistema operativo è un software che gestisce l'hardware di un computer  fornendo un interfaccia di comunicazione tra l'utente e il computer. Nel tempo sono stati progettati diverse tipologie di sistemi operativi, come quello per mainframe, progettato per ottimizzare l'utilizzo dell'hardware; i [[Lezione 2 - Tipologie di sistemi#Sistemi operativi time-sharing|sistemi time-sharing]], nati per consentire l'uso del calcolatore a più utenti in contemporanea ecc.  
Un sistema operativo è un software molto complesso e quindi è realizzato in moduli, ciascuno dei quali svolge un compito ben preciso.  
Un sistema di elaborazione può essere seguito nel seguente modo: 

![[SOR/img/img0.png|center|500]]  

- L'hardware, costituito dai componenti fisici del computer, fornisce le risorse di calcolo di base al sistema.  
Il sistema operativo gestisce e controlla le risorse hardware, necessarie per l'esecuzione di un programma, coordinando il suo utilizzo tra le varie applicazioni degli utenti.
## Funzionamento di un computer
Un moderno computer è costituito da uno o più processori e da un numero di controller di dispositivi (in celeste nella foto) connessi mediante bus di sistema comune che forniscono l’accesso alla memoria condivisa.

![[SOR/img/img1.png|center|500]]  

- Un controller è un modulo elettronico programmabile. Ogni controller gestisce un particolare dispositivo.  
- I processori e i controller dei dispositivi sono in grado di eseguire istruzioni in parallelo, competendo tra loro per accedere alla memoria. Per garantire un accesso ordinato alla memoria, nell'hardware del computer è presente un dispositivo che sincronizza l'accesso ad essa.
- Al momento dell'accensione del computer, il processore inizia a eseguire istruzioni a partire da un indirizzo predefinito. A tale indirizzo è mappato un chip di memoria EEPROM (Electrically Erasable Programmable Read-Only Memory), una memoria programmabile cancellabile elettricamente che può essere riscritta più volte pur mantenendo i dati in modo permanente. In questo chip è memorizzato il firmware del calcolatore, noto con il termine UEFI (che di recente ha sostituito il BIOS), il quale è costituito da una serie di routine che inizializzano e testano le componenti hardware. Inoltre nel firmaware è memorizzato l'indirizzo del disco in cui è presente un programma che carica il kernel del sistema operativo. Il kernel, una volta in esecuzione, legge i file di configurazione del sistema e avvia un certo numero di programmi di sistema.  
- Terminata questa fase, il sistema attende un evento segnalato da un interrupt di tipo hardware (inviando un segnale al processore mediante le linee di controllo del bus di sistema) o software (eseguendo una chiamata di sistema).  
- Quando riceve un interrupt, il processore sospende il flusso di istruzioni che stava eseguendo e continua l'esecuzione da un indirizzo di memoria prefissato in cui è memorizzata la routine per l'interrupt ricevuto. La CPU esegue la routine di servizio dell'interrupt e al termine riprende la sequenza di istruzioni interrotta. Generalmente, poiché il numero degli interrupt è limitato, si usa una tabella di puntatori a routine d’interrupt detta **vettore delle interruzioni**, che contiene gli indirizzi iniziali delle routine di servizio d’interruzione per i vari dispositivi. La funzione d’interrupt deve anche salvare l’indirizzo dell’istruzione interrotta e lo stato attuale del processore e ripristinarlo prima di tornare al flusso di esecuzione interrotto.
## Struttura della memoria
Il processore legge le istruzioni da una memoria principale, per questo i programmi devono essere caricati in memoria prima di essere eseguiti. Tutti i tipi di memoria sono gestiti come un vettore di byte in cui è possibile eseguire operazioni di scrittura e lettura. Ogni byte ha un proprio indirizzo. L’istruzione di lettura trasferisce un byte o una parola (gruppo di byte) da una particolare locazione della memoria principale a uno dei registri interni della CPU, mentre l’istruzione di scrittura, viceversa, copia il contenuto di uno dei registri della CPU a una locazione specifica di memoria principale.  
Un tipico ciclo di esecuzione di un’istruzione, prima preleva un’istruzione dalla memoria e la memorizza nel registro istruzioni, poi è decodificata ed eventualmente può richiedere il trasferimento di alcuni operandi dalla memoria e copiati in qualche registro interno della CPU. Dopo l’esecuzione dell’istruzione sugli operandi, il risultato può essere memorizzato in qualche locazione della memoria principale. Per migliorare le prestazioni, molti processori hanno un architettura che consente l'esecuzione di più istruzioni contemporaneamente.  
La memoria principale è una memoria voltatile ed è troppo piccola perché contenga tutti i programmi e i dati necessari in modo permanente, per questo i computer sono dotati di dispositivi di memorizzazione secondaria. I dispositivi più comuni sono gli hard disk e gli SSD.  
## Struttura di I/O
Una parte del sistema operativo è dedicato alla gestione dei dispositivi di I/O. Un computer general-purpose è composto da uno o più processori e da più controller di dispositivi che sono connessi attraverso un bus comune, ciascuno dei quali si occuoa di uno specifico tipo di dispositivo. Un controller di dispositivo è dotato di un buffer locale di memorizzazione e dei registri ed è responsabile di trasferire i dati tra i dispositivi periferici che controlla e il suo buffer locale.  
Nei sistemi operativi è presente un **driver** per ogni controller. Un driver è un modulo software che fornisce al resto del sistema operativo un interfaccia per la gestione del dispositivo. Per avviare un’operazione di I/O, il driver carica dati in dei registri del controller del dispositivo. Il controller del dispositivo esamina il contenuto di questi registri per determinare l’azione da fare e avvia il trasferimento dei dati dal dispositivo al buffer locale. Una volta che il trasferimento dei dati è completo, il controller del dispositivo informa il driver di periferica tramite interrupt che ha terminato il suo compito. Il driver restituisce il controllo al sistema operativo, restituendo i dati o un puntatore ai dati in caso di un’operazione di lettura. Per altre operazioni, il driver di periferica restituisce informazioni di stato. Questa tecnica di trasferimento dati basata su interruzione I/O è utile per piccole quantità di dati, perchè in caso di trasferimento di grandi blocchi di dati produce molto overhead.  
Per risolvere questo problema è utilizzato l'accesso diretto alla memoria (DMA). Dopo aver impostato buffer, puntatori, e contatori per il dispositivo di I/O, il controller del dispositivo trasferisce direttamente un intero blocco di dati tra il proprio buffer e la memoria, senza alcun intervento da parte della CPU. Un solo interrupt è generato per ogni blocco, per informare il driver di periferica che l’operazione è stata completata, piuttosto che un interrupt per ogni byte generato per periferiche a bassa velocità. Mentre il controller di periferica esegue queste operazioni, la CPU è disponibile per svolgere altri compiti.  
